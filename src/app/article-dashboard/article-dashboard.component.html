<div class="container">
  <!-- Barre de recherche -->
  <div class="search-container mb-4">
    <div class="input-group shadow-sm">
      <span class="input-group-text">
        <i class="fas fa-search"></i>
      </span>
      <input
        type="text"
        class="form-control search-input"
        placeholder="Rechercher un article par nom, catégorie ou prix..."
        [(ngModel)]="searchTerm"
        (input)="onSearch()"
        autocomplete="off"
      >
    </div>
    <small class="text-muted mt-2" *ngIf="searchTerm && filteredArticleData.length === 0">
      Aucun article trouvé pour "{{searchTerm}}"
    </small>
  </div>
  <div *ngIf="filteredArticleData.length === 0 && !searchTerm" class="text-center py-5">
    <div class="d-flex flex-column align-items-center">
      <i class="bi bi-inbox" style="font-size: 4rem; color: #6c757d;"></i>
      <p class="mt-3 h5 text-muted">Aucun article pour le moment</p>
      <p class="text-muted">Cliquez sur "Ajouter un Article" pour commencer</p>
    </div>
  </div>

  <table class="table table-striped table-hover" *ngIf="filteredArticleData.length > 0">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Nom</th>
        <th>Catégorie</th>
        <th>Prix (€)</th>
        <th>Stock</th>
        <th>Image</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let row of filteredArticleData">
        <td>{{ row.id }}</td>
        <td>{{ row.nomArt }}</td>
        <td>{{ row.categorie }}</td>
        <td>{{ row.prix | currency:'EUR' }}</td>
        <td>{{ row.stock }}</td>
        <td>
          <img [src]="row.image || 'assets/placeholder.png'" width="50" height="50" class="img-thumbnail">
        </td>
        <td>
          <button class="btn btn-sm btn-info me-2" (click)="showDetails(row)" title="Détails">
            <i class="fas fa-info-circle"></i>
          </button>
          <button class="btn btn-sm btn-warning me-2" (click)="onEdit(row)" title="Modifier">
            <i class="fas fa-edit"></i>
          </button>
          <button class="btn btn-sm btn-danger" (click)="deleteArticle(row)" title="Supprimer">
            <i class="fas fa-trash-alt"></i>
          </button>
        </td>
      </tr>
    </tbody>
  </table>

  <!-- Pagination -->
  <div class="d-flex justify-content-center mt-4">
    <div class="btn-group btn-group-sm">
      <button class="btn border" [disabled]="currentPage === 1" (click)="onPageChange(currentPage - 1)" style="background-color: white;">
        <i class="bi bi-chevron-left"></i>
      </button>
      <button class="btn px-3" style="background-color: #363B48; color: white;">{{ currentPage }}</button>
      <button class="btn border" [disabled]="currentPage === pages.length" (click)="onPageChange(currentPage + 1)" style="background-color: white;">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </div>
</div>

<!-- Modal Détails -->
<div class="modal fade" id="detailsModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title">Détails de l'Article</h5>
        <button type="button" class="btn-close btn-close-white" (click)="closeDetailsModal()"></button>
      </div>
      <div class="modal-body" *ngIf="selectedArticle">
        <div class="row">
          <div class="col-md-4">
            <img [src]="selectedArticle.image || 'assets/placeholder.png'" 
                 class="img-fluid rounded" 
                 alt="Image de l'article">
          </div>
          <div class="col-md-8">
            <h4>{{ selectedArticle.nomArt }}</h4>
            <hr>
            <div class="row mb-4">
              <div class="col-md-6">
                <div class="mb-3">
                  <strong>Catégorie :</strong>
                  <span class="ms-2 fw-normal">{{ selectedArticle.categorie }}</span>
                </div>
                <div class="mb-3">
                  <strong>Prix :</strong>
                  <span class="ms-2 h5" style="color: #2ecc71;">{{ selectedArticle.prix | currency:'EUR' }}</span>
                </div>
                <div class="mb-3">
                  <strong>Stock :</strong>
                  <span class="ms-2 fw-normal">{{ selectedArticle.stock }} unités</span>
                </div>
                <div class="mb-3">
                  <strong>Référence :</strong>
                  <span class="ms-2 text-muted">ART-{{ selectedArticle.id.toString().padStart(4, '0') }}</span>
                </div>
              </div>
              <div class="col-md-6">
                <!-- Information de stock -->
                <div class="card mb-3">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <strong>Statut :</strong>
                      <span>{{ selectedArticle.stock > 10 ? 'En stock' : selectedArticle.stock > 0 ? 'Stock limité' : 'Rupture de stock' }}</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                      <strong>Valeur en stock :</strong>
                      <span>{{ selectedArticle.prix * selectedArticle.stock | currency:'EUR' }}</span>
                    </div>
                  </div>
                </div>
                <!-- Information de prix -->
                <div class="card">
                  <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <strong>Prix TTC :</strong>
                      <span>{{ selectedArticle.prix | currency:'EUR' }}</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-2">
                      <strong>Prix HT :</strong>
                      <span>{{ selectedArticle.prix / 1.2 | currency:'EUR' }}</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                      <strong>TVA (20%) :</strong>
                      <span>{{ selectedArticle.prix * 0.2 | currency:'EUR' }}</span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="border-top pt-3 mt-3 px-3">
              <div class="d-flex align-items-center mb-2">
                <i class="bi bi-file-text me-2"></i>
                <span class="fw-medium">Description</span>
              </div>
              <p class="text-muted mb-0" style="line-height: 1.6;">
                {{ selectedArticle.description || 'Aucune description disponible pour cet article.' }}
              </p>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-dark" (click)="closeDetailsModal()">
          Fermer
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Modal de modification -->
<div class="modal fade" id="staticBackdrop" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title" id="staticBackdropLabel">{{ articleModelObj.id ? 'Modifier' : 'Ajouter' }} un Article</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close" (click)="closeModal()"></button>
      </div>
      <div class="modal-body">
        <form [formGroup]="formValue">
          <div class="row g-3">
            <div class="col-md-6">
              <label class="form-label">Nom de l'article</label>
              <input type="text" class="form-control" formControlName="nomArt" required>
            </div>
            <div class="col-md-6">
              <label class="form-label">Catégorie</label>
              <select class="form-select" formControlName="categorie" required>
                <option value="">Sélectionner une catégorie</option>
                <option *ngFor="let cat of categories" [value]="cat.name">
                  {{ cat.name }}
                </option>
              </select>
            </div>
            <div class="col-12">
              <label class="form-label">Description</label>
              <textarea class="form-control" formControlName="description" rows="2"></textarea>
            </div>
            <div class="col-md-4">
              <label class="form-label">Prix (€)</label>
              <input type="number" class="form-control" formControlName="prix" min="0" step="0.01" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Stock</label>
              <input type="number" class="form-control" formControlName="stock" min="0" required>
            </div>
            <div class="col-md-4">
              <label class="form-label">Image</label>
              <select class="form-select" formControlName="image">
                <option value="">Sélectionner une image</option>
                <option *ngFor="let img of availableImages; let i = index" [value]="img">
                  Image {{ i + 1 }}
                </option>
              </select>
              <div class="mt-2" *ngIf="formValue.get('image')?.value">
                <img [src]="formValue.get('image')?.value" class="img-thumbnail" style="max-width: 100px">
              </div>
            </div>
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeModal()">Annuler</button>
        <button *ngIf="!articleModelObj.id" type="button" class="btn btn-primary" 
                (click)="postArticleDetails()" [disabled]="!formValue.valid">Ajouter</button>
        <button *ngIf="articleModelObj.id" type="button" class="btn btn-warning" 
                (click)="updateArticleDetails()" [disabled]="!formValue.valid">Modifier</button>
      </div>
    </div>
  </div>
</div>